<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Migo App</title>
    <style>
        :root {
            --wa-green: #76c1a5;
            --migo-white: #ffffff;
            --user-bg: #f1f5f9;
            --error-red: #f43f5e;
            --header-h: 60px;
            --input-h: 70px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--wa-green);
            background-image: url("https://www.transparenttextures.com/patterns/doodle-weave.png");
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Evita el scroll elástico del móvil */
        }

        header {
            height: var(--header-h);
            background: #ffffff;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .main-layout {
            display: flex;
            flex-direction: column; /* En móvil, las ventanas van una sobre otra o se esconden */
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* CHAT AREA */
        #chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.9);
            margin: 10px;
            border-radius: 20px;
            overflow: hidden;
        }

        #messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            -webkit-overflow-scrolling: touch;
        }

        .bubble {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 85%;
            font-size: 15px;
            align-self: flex-start;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            line-height: 1.4;
        }

        .migo-msg { background: var(--migo-white); border: 1px solid #e2e8f0; border-bottom-left-radius: 4px; }
        .user-msg { background: var(--user-bg); border: 1px solid #cbd5e1; border-bottom-left-radius: 4px; }
        .blocking-msg { border: 2px solid var(--error-red); background: #fff1f2; color: #b91c1c; }

        /* PANELES LATERALES (Convertidos en pestañas o widgets móviles) */
        .mobile-widgets {
            display: flex;
            height: 180px;
            gap: 10px;
            padding: 0 10px 10px 10px;
        }

        .side-panel {
            background: white;
            border-radius: 15px;
            padding: 10px;
            flex: 1;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            font-size: 12px;
        }

        /* Ajuste de ancho 40% más estrecho para el Academy Record */
        #academy-record { flex: 0.6; } 

        .trans-box { width: 100%; border: 1px solid #e2e8f0; border-radius: 8px; padding: 5px; font-size: 11px; margin-bottom: 5px; outline: none; }
        .result-trans { background: #f8fafc; min-height: 25px; padding: 4px; border-radius: 4px; font-weight: bold; font-size: 11px; }

        #record-list { overflow-y: auto; flex: 1; }
        .error-card { background: #fff1f2; border-left: 3px solid var(--error-red); padding: 5px; border-radius: 4px; margin-bottom: 5px; font-size: 10px; }

        /* INPUT BAR MÓVIL */
        .input-bar {
            height: var(--input-h);
            background: white;
            display: flex;
            padding: 10px 15px;
            gap: 10px;
            border-top: 1px solid #eee;
        }

        #userInput {
            flex: 1;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            padding: 0 20px;
            font-size: 16px; /* Evita zoom automático en iPhone */
            outline: none;
        }

        #userInput.locked { border-color: var(--error-red); background: #fff1f2; }

        .btn-send {
            width: 50px;
            height: 50px;
            background: #1e293b;
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .hint-text { color: var(--error-red); font-weight: bold; font-size: 11px; display: block; margin-top: 5px; }
    </style>
</head>
<body>

    <header>
        <div style="font-weight: 900; color: #1e293b;">MIGO APP</div>
    </header>

    <div class="main-layout">
        <div id="chat-container">
            <div id="messages">
                <div class="bubble migo-msg"><strong>Migo:</strong> Hello! Let's chat in English. Be careful with your grammar!</div>
            </div>
        </div>

        <div class="mobile-widgets">
            <div class="side-panel">
                <strong style="font-size: 10px;">TRANSLATOR</strong>
                <input id="es-en-in" class="trans-box" placeholder="Español...">
                <div id="es-en-out" class="result-trans">...</div>
                <input id="en-es-in" class="trans-box" placeholder="English..." style="margin-top:5px;">
                <div id="en-es-out" class="result-trans">...</div>
            </div>

            <div id="academy-record" class="side-panel">
                <strong style="font-size: 10px;">RECORDS</strong>
                <div id="record-list"></div>
            </div>
        </div>

        <div class="input-bar">
            <input type="text" id="userInput" placeholder="Message..." autocomplete="off">
            <button class="btn-send" id="sendBtn">></button>
        </div>
    </div>

    <script>
        // Lógica de Traducción
        async function translate(text, from, to, outId) {
            const out = document.getElementById(outId);
            if(!text.trim()) { out.innerText = "..."; return; }
            try {
                const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}`);
                const data = await res.json();
                out.innerText = data.responseData.translatedText;
            } catch(e) { out.innerText = "Error"; }
        }

        document.getElementById('es-en-in').addEventListener('change', (e) => translate(e.target.value, 'es', 'en', 'es-en-out'));
        document.getElementById('en-es-in').addEventListener('change', (e) => translate(e.target.value, 'en', 'es', 'en-es-out'));

        // Lógica Migo
        let locked = false;
        let correctWord = "";
        const errors = { "helo": "Hello", "i is": "I am", "thanks you": "Thank you" };

        function send() {
            const input = document.getElementById('userInput');
            const val = input.value.trim();
            if(!val) return;

            if(locked) {
                if(val.toLowerCase() === correctWord.toLowerCase()) {
                    locked = false;
                    input.classList.remove('locked');
                    addMsg(`<strong>You:</strong> ${val}`, 'user-msg');
                    input.value = '';
                    setTimeout(() => addMsg(`<strong>Migo:</strong> Good job! Unlocked.`, 'migo-msg'), 500);
                } else {
                    input.value = '';
                    addMsg(`<strong>Migo:</strong> Write "${correctWord}"`, 'migo-msg blocking-msg');
                }
                return;
            }

            addMsg(`<strong>You:</strong> ${val}`, 'user-msg');
            input.value = '';

            setTimeout(() => {
                let low = val.toLowerCase();
                let errKey = Object.keys(errors).find(k => low.includes(k));

                if(errKey) {
                    locked = true;
                    correctWord = errors[errKey];
                    input.classList.add('locked');
                    addMsg(`<strong>Migo:</strong> Error! Correct: "${correctWord}"`, 'migo-msg blocking-msg');
                    logRecord(val, correctWord);
                } else {
                    addMsg(`<strong>Migo:</strong> Understood! Tell me more.`, 'migo-msg');
                }
            }, 600);
        }

        document.getElementById('sendBtn').onclick = send;
        document.getElementById('userInput').onkeypress = (e) => { if(e.key==='Enter') send(); };

        function addMsg(html, cls) {
            const m = document.getElementById('messages');
            const d = document.createElement('div');
            d.className = `bubble ${cls}`;
            d.innerHTML = html;
            m.appendChild(d);
            m.scrollTop = m.scrollHeight;
        }

        function logRecord(orig, corr) {
            const list = document.getElementById('record-list');
            const now = new Date();
            const time = now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');
            const card = document.createElement('div');
            card.className = 'error-card';
            card.innerHTML = `[${time}] ${orig} -> ${corr}`;
            list.prepend(card);
        }
    </script>
</body>
</html>